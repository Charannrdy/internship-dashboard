<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Internship Charts Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1, h2 { text-align: center; }
    .chart-container { display: none; margin: 30px auto; width: 90%; max-width: 1000px; background: #fff; padding: 20px; box-shadow: 0 0 10px #ccc; border-radius: 8px; }
    canvas { background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
    #mapLinks li { margin: 6px 0; }
  </style>
</head>
<body>
  <h1>Internship Task Dashboard</h1>

  <div class="chart-container" id="chart1">
    <h2>Top 20 Companies - UI/UX Designer</h2>
    <canvas id="uxChart"></canvas>
  </div>

  <div class="chart-container" id="chart2">
    <h2>Preference vs Work Type (Intern)</h2>
    <canvas id="prefWorkChart"></canvas>
  </div>

  <div class="chart-container" id="chart3">
    <h2>Top 10 Companies - Data Engineer for Females</h2>
    <canvas id="dataEngineerChart"></canvas>
  </div>

  <div class="chart-container" id="chart4">
    <h2>African Jobs (Male, Full-Time with Location)</h2>
    <canvas id="africanJobsChart"></canvas>
    <ul id="mapLinks"></ul>
  </div>

  <div class="chart-container" id="chart5">
    <h2>India vs Germany - High Paying Jobs (Female)</h2>
    <canvas id="indiaGermanyChart"></canvas>
  </div>

  <div class="chart-container" id="chart6">
    <h2>Mechanical Engineer Jobs in Asia</h2>
    <canvas id="mechChart"></canvas>
  </div>

  <script>
    function getISTHour() {
      const now = new Date();
      return now.getUTCHours() + 5.5;
    }

    function isBetweenIST(start, end) {
      const hour = getISTHour();
      return hour >= start && hour < end;
    }

    function showChart(id, condition = true) {
      if (condition) document.getElementById(id).style.display = 'block';
    }

    // Time-conditional rendering
    showChart('chart1'); // Always visible
    showChart('chart2', isBetweenIST(15, 17));
    showChart('chart3', isBetweenIST(15, 17));
    showChart('chart4', isBetweenIST(15, 18));
    showChart('chart5', isBetweenIST(15, 17));
    showChart('chart6', isBetweenIST(15, 17));

    const API_BASE = 'https://internship-dashboard-api.onrender.com/api';

    async function fetchChartData(endpoint) {
      try {
        const res = await fetch(`${API_BASE}/${endpoint}`);
        return await res.json();
      } catch (err) {
        console.error(`Error fetching ${endpoint}:`, err);
        return { labels: [], data: [] };
      }
    }

    async function renderAllCharts() {
      const [ux, pref, dataeng, africa, indiaGermany, mech] = await Promise.all([
        fetchChartData('ux'),
        fetchChartData('pref-worktype'),
        fetchChartData('dataengineer'),
        fetchChartData('africa'),
        fetchChartData('indiagermany'),
        fetchChartData('mechengineer')
      ]);

      new Chart(document.getElementById("uxChart").getContext("2d"), {
        type: 'bar',
        data: {
          labels: ux.labels,
          datasets: [{ label: "UI/UX Designers", data: ux.data, backgroundColor: '#42a5f5' }]
        }
      });

      new Chart(document.getElementById("prefWorkChart").getContext("2d"), {
        type: 'bar',
        data: {
          labels: pref.labels,
          datasets: [{ label: "Preferences", data: pref.data, backgroundColor: '#ffca28' }]
        }
      });

      new Chart(document.getElementById("dataEngineerChart").getContext("2d"), {
        type: 'bar',
        data: {
          labels: dataeng.labels,
          datasets: [{ label: "Female Candidates", data: dataeng.data, backgroundColor: '#ec407a' }]
        }
      });

      new Chart(document.getElementById("africanJobsChart").getContext("2d"), {
        type: 'bar',
        data: {
          labels: africa.labels,
          datasets: [{ label: "Jobs", data: africa.data, backgroundColor: '#ab47bc' }]
        }
      });

      const mapList = document.getElementById('mapLinks');
      if (africa.coords && Array.isArray(africa.coords)) {
        africa.coords.forEach(c => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="https://maps.google.com/?q=${c.lat},${c.lng}" target="_blank">Latitude: ${c.lat}, Longitude: ${c.lng}</a>`;
          mapList.appendChild(li);
        });
      }

      new Chart(document.getElementById("indiaGermanyChart").getContext("2d"), {
        type: 'bar',
        data: {
          labels: indiaGermany.labels,
          datasets: [
            { label: "India", data: indiaGermany.india, backgroundColor: "orange" },
            { label: "Germany", data: indiaGermany.germany, backgroundColor: "green" }
          ]
        }
      });

      new Chart(document.getElementById("mechChart").getContext("2d"), {
        type: 'bar',
        data: {
          labels: mech.labels,
          datasets: [{ label: "Male Applicants", data: mech.data, backgroundColor: '#29b6f6' }]
        }
      });
    }

    renderAllCharts();
  </script>
</body>
</html>
